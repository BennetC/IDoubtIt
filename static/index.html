<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lying Replay Viewer</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="tabs">
      <button class="tab active" data-tab="replay">Replay</button>
      <button class="tab" data-tab="play">Play</button>
    </div>
    <div id="replay-controls" class="controls">
      <label>
        Replay
        <select id="replay-select"></select>
      </label>
      <span id="step-counter">Step 0 / 0</span>
      <div class="buttons">
        <button id="btn-start" title="Start">&laquo;</button>
        <button id="btn-prev" title="Previous">&lsaquo;</button>
        <button id="btn-play" title="Play">Play</button>
        <button id="btn-next" title="Next">&rsaquo;</button>
        <button id="btn-end" title="End">&raquo;</button>
      </div>
      <label>
        Speed
        <select id="speed-select">
          <option value="0.5">0.5x</option>
          <option value="1" selected>1x</option>
          <option value="2">2x</option>
          <option value="4">4x</option>
        </select>
      </label>
      <label class="toggle">
        <input type="checkbox" id="public-toggle" />
        Public view
      </label>
    </div>
    <div id="play-controls" class="controls hidden">
      <label>
        Players
        <select id="play-player-count">
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4" selected>4</option>
          <option value="5">5</option>
          <option value="6">6</option>
        </select>
      </label>
      <label>
        Human Seat
        <select id="play-human-seat"></select>
      </label>
      <label>
        Bot Type
        <select id="play-bot-type">
          <option value="random" selected>random</option>
          <option value="heuristic">heuristic</option>
        </select>
      </label>
      <label>
        Seed
        <input id="play-seed" type="number" placeholder="optional" />
      </label>
      <div class="buttons">
        <button id="play-start">Start New Game</button>
        <button id="play-pause">Pause</button>
        <button id="play-resume">Resume</button>
        <button id="play-stop">Stop Game</button>
      </div>
      <label>
        Save Name
        <input id="play-save-name" type="text" placeholder="my-save" />
      </label>
      <button id="play-save">Save Game</button>
      <label>
        Saves
        <select id="play-save-select"></select>
      </label>
      <button id="play-load">Load Game</button>
      <label class="toggle">
        <input type="checkbox" id="play-debug-toggle" />
        Debug view
      </label>
      <label class="toggle">
        <input type="checkbox" id="play-bot-eval-toggle" />
        Debug: Bot eval
      </label>
    </div>
    <input id="step-slider" type="range" min="0" max="0" value="0" />
  </header>

  <main>
    <section id="replay-view" class="layout">
      <section class="panel left">
        <h2>Current Event</h2>
        <div id="event-text" class="event-text">Load a replay to begin.</div>
        <div class="state-list">
          <div><strong>Active Rank:</strong> <span id="active-rank">-</span></div>
          <div><strong>Current Turn:</strong> <span id="current-player">-</span></div>
          <div><strong>Pile Size:</strong> <span id="pile-size">0</span></div>
        </div>
        <details class="history" open>
          <summary>History</summary>
          <div class="history-controls">
            <label>
              Order
              <select id="history-order">
                <option value="desc" selected>Newest first</option>
                <option value="asc">Oldest first</option>
              </select>
            </label>
          </div>
          <ol id="history-list"></ol>
        </details>
        <details class="history">
          <summary>Bot Eval (Current Event)</summary>
          <div id="replay-bot-eval" class="bot-eval-panel"></div>
        </details>
      </section>

      <section class="panel center">
        <h2>Pile</h2>
        <div id="pile-cards" class="card-list"></div>
      </section>

      <section class="panel right">
        <h2>Players</h2>
        <div id="players"></div>
      </section>
    </section>

    <section id="play-view" class="layout hidden">
      <section class="panel left">
        <h2>Game Status</h2>
        <div id="play-status" class="event-text">Start a new game to begin.</div>
        <div class="state-list">
          <div><strong>Active Rank:</strong> <span id="play-active-rank">-</span></div>
          <div><strong>Current Turn:</strong> <span id="play-current-player">-</span></div>
          <div><strong>Pile Size:</strong> <span id="play-pile-size">0</span></div>
        </div>
        <div class="human-actions">
          <h3>Human Action</h3>
          <div id="play-decision" class="player-meta">Waiting for game start.</div>
          <div id="play-rank-buttons" class="buttons wrap"></div>
          <div id="play-hand" class="card-list"></div>
          <button id="play-submit" class="hidden">Play Selected</button>
          <div id="play-challenge-buttons" class="buttons wrap"></div>
        </div>
        <details class="history" open>
          <summary>History</summary>
          <div class="history-controls">
            <label>
              Order
              <select id="play-history-order">
                <option value="desc" selected>Newest first</option>
                <option value="asc">Oldest first</option>
              </select>
            </label>
          </div>
          <ol id="play-history-list"></ol>
        </details>
        <details class="history">
          <summary>Bot Eval (Live)</summary>
          <ol id="play-bot-eval-list" class="bot-eval-list"></ol>
        </details>
        <details class="history">
          <summary>After-game analysis</summary>
          <div class="history-controls">
            <label>
              Player
              <select id="play-bot-eval-player-filter"></select>
            </label>
            <label>
              Decision
              <select id="play-bot-eval-type-filter">
                <option value="all" selected>All</option>
                <option value="CHALLENGE_DECISION">Challenge decisions</option>
                <option value="SELECT_RANK">Rank selections</option>
              </select>
            </label>
          </div>
          <ol id="play-bot-eval-analysis" class="bot-eval-list"></ol>
        </details>
      </section>

      <section class="panel center">
        <h2>Pile</h2>
        <div id="play-pile-cards" class="card-list"></div>
      </section>

      <section class="panel right">
        <h2>Players</h2>
        <div id="play-players"></div>
      </section>
    </section>
  </main>

  <div id="error-banner" class="error hidden"></div>
  <div id="play-error-banner" class="error hidden"></div>

  <script src="app.js"></script>
</body>
</html>
